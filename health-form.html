<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ‰æ–¹å®¶ï¼Œæ‚¨çš„å¥åº·ç®¡å®¶</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans SC', sans-serif; background-color: #f0f4f8; color: #1e293b; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; padding: 40px 20px; }
        /* å¼ºåˆ¶ä¿®å¤å®¹å™¨å±…ä¸­å’Œé˜´å½± */
        .main-container { width: 100%; max-width: 600px; background: white; border-radius: 40px; shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); overflow: hidden; }
        .form-section { display: none; }
        .form-section.active { display: block; animation: slideUp 0.4s ease-out; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .input-box { width: 100%; padding: 16px; background-color: #f8fafc; border: 2px solid #f1f5f9; border-radius: 16px; transition: all 0.3s; }
        .input-box:focus { border-color: #2563eb; outline: none; background-color: #fff; }
    </style>
</head>
<body>

    <div class="main-container shadow-2xl">
        <div class="bg-[#1a233b] p-8 text-white">
            <h1 class="text-2xl font-bold text-[#4e94ff]">æœ‰æ–¹å®¶ï¼Œæ‚¨çš„å¥åº·ç®¡å®¶</h1>
            <p id="step-desc" class="text-slate-400 text-xs mt-2 italic">ç¬¬ä¸€æ­¥ï¼šåŸºç¡€æŒ‡æ ‡å½•å…¥ â€”â€” å»ºç«‹ä»£è°¢åŸºå‡†</p>
            <div class="w-full bg-slate-700 h-1 mt-6 rounded-full overflow-hidden">
                <div id="progress-bar" class="bg-blue-500 h-full transition-all duration-500" style="width: 25%;"></div>
            </div>
        </div>

        <form id="healthForm" class="p-8 space-y-6">
            <div id="section-1" class="form-section active space-y-5">
                <div>
                    <label class="block text-sm font-semibold mb-2">å§“å</label>
                    <input type="text" name="username" required class="input-box" placeholder="è¯·è¾“å…¥æ‚¨çš„çœŸå®å§“å">
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-2">è”ç³»ç”µè¯</label>
                    <input type="tel" name="phone" required class="input-box" placeholder="å¡«å†™æœ‰æ•ˆå·ç ">
                </div>
                <div>
                    <label class="block text-sm font-semibold mb-3">æ‚¨çš„æ€§åˆ«</label>
                    <div class="flex gap-4">
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="gender" value="ç”·" class="hidden peer" required>
                            <div class="p-4 border-2 border-slate-100 rounded-2xl text-center peer-checked:border-blue-600 peer-checked:bg-blue-50 peer-checked:text-blue-700 transition">ç”· (Male)</div>
                        </label>
                        <label class="flex-1 cursor-pointer">
                            <input type="radio" name="gender" value="å¥³" class="hidden peer">
                            <div class="p-4 border-2 border-slate-100 rounded-2xl text-center peer-checked:border-blue-600 peer-checked:bg-blue-50 peer-checked:text-blue-700 transition">å¥³ (Female)</div>
                        </label>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold mb-2">å¹´é¾„ (å²)</label>
                        <input type="number" name="age" class="input-box" required>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">èº«é«˜ (cm)</label>
                        <input type="number" id="height" name="height" class="input-box" required>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">å½“å‰ä½“é‡ (kg)</label>
                        <input type="number" id="weight" name="weight" class="input-box" required>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold mb-2">ç›®æ ‡ä½“é‡ (kg)</label>
                        <input type="number" name="target_weight" class="input-box">
                    </div>
                </div>
                <div id="bmi-panel" class="hidden p-5 rounded-2xl flex justify-between items-center text-white">
                    <div>
                        <p class="text-xs font-bold opacity-80 uppercase">æ‚¨çš„ BMI æŒ‡æ•°</p>
                        <p id="bmi-status" class="text-sm font-bold mt-1">--</p>
                    </div>
                    <span id="bmi-val" class="text-3xl font-black">--</span>
                </div>
            </div>

            <div class="pt-4 flex gap-4">
                <button type="button" id="prevBtn" class="hidden flex-1 py-4 border-2 border-slate-200 text-slate-500 font-bold rounded-2xl transition hover:bg-slate-50">è¿”å›</button>
                <button type="button" id="nextBtn" class="flex-1 py-4 bg-[#2563eb] text-white font-bold rounded-2xl shadow-lg hover:bg-blue-700 transition">ç»§ç»­ä¸‹ä¸€æ­¥</button>
                <button type="button" id="submitBtn" class="hidden flex-1 py-4 bg-green-600 text-white font-bold rounded-2xl shadow-lg hover:bg-green-700 transition">æäº¤æ¡£æ¡ˆ</button>
            </div>
        </form>
    </div>

    <div id="resultModal" class="hidden fixed inset-0 bg-slate-900/90 flex items-center justify-center p-4 z-50 backdrop-blur-sm">
        <div class="bg-white rounded-[2rem] p-8 w-full max-w-sm text-center">
            <div class="w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-4 text-2xl">âœ“</div>
            <h2 class="text-xl font-bold mb-2">æäº¤æˆåŠŸ</h2>
            <p class="text-slate-500 text-sm mb-6">æ•°æ®å·²åŒæ­¥è‡³é£ä¹¦ç¾¤èŠåŠåå°è¡¨æ ¼</p>
            <button onclick="location.reload()" class="w-full py-4 bg-blue-600 text-white rounded-2xl font-bold">ç¡®å®š</button>
        </div>
    </div>

<script>
    // é…ç½®é£ä¹¦åœ°å€
    const webhookUrl = "https://open.feishu.cn/open-apis/bot/v2/hook/480dc012-2838-4b4c-8274-a0dd2b6b80f9";
    
    let currentStep = 1;
    const totalSteps = 4; // è¿™é‡Œæ ¹æ®ä½ å®é™…çš„ section æ•°é‡è°ƒæ•´

    // BMI è®¡ç®—
    function calcBMI() {
        const h = document.getElementById('height').value / 100;
        const w = document.getElementById('weight').value;
        const panel = document.getElementById('bmi-panel');
        if (h > 0 && w > 0) {
            const bmi = (w / (h * h)).toFixed(1);
            document.getElementById('bmi-val').innerText = bmi;
            panel.classList.remove('hidden');
            let status = "æ­£å¸¸", color = "bg-green-500";
            if(bmi >= 24) { status = "è¶…é‡"; color = "bg-orange-500"; }
            else if(bmi >= 28) { status = "è‚¥èƒ–"; color = "bg-red-500"; }
            else if(bmi < 18.5) { status = "åç˜¦"; color = "bg-blue-500"; }
            document.getElementById('bmi-status').innerText = status;
            panel.className = `p-5 rounded-2xl flex justify-between items-center text-white transition-all ${color}`;
        }
    }
    document.getElementById('height').addEventListener('input', calcBMI);
    document.getElementById('weight').addEventListener('input', calcBMI);

    // ä¸‹ä¸€æ­¥æŒ‰é’®
    document.getElementById('nextBtn').addEventListener('click', () => {
        // ç®€åŒ–ç‰ˆè·³è½¬é€»è¾‘ï¼Œä»…ä¸ºæ¼”ç¤º
        currentStep++;
        if(currentStep > 1) document.getElementById('prevBtn').classList.remove('hidden');
        if(currentStep === totalSteps) {
            document.getElementById('nextBtn').classList.add('hidden');
            document.getElementById('submitBtn').classList.remove('hidden');
        }
        document.getElementById('progress-bar').style.width = (currentStep/totalSteps)*100 + '%';
    });

    // æ ¸å¿ƒï¼šå‘é€é£ä¹¦å¡ç‰‡
    document.getElementById('submitBtn').addEventListener('click', async () => {
        const form = document.getElementById('healthForm');
        const fd = new FormData(form);
        const data = Object.fromEntries(fd.entries());
        const bmiVal = document.getElementById('bmi-val').innerText;

        // æ„å»ºè¯¦ç»†å¡ç‰‡
        const cardPayload = {
            "msg_type": "interactive",
            "card": {
                "header": { "title": { "tag": "plain_text", "content": "ğŸ†• æ–°å¥åº·æ¡£æ¡ˆå½•å…¥" }, "template": "blue" },
                "elements": [
                    { "tag": "div", "fields": [
                        { "is_short": true, "text": { "tag": "lark_md", "content": `**ğŸ‘¤ å§“åï¼š**\n${data.username}` } },
                        { "is_short": true, "text": { "tag": "lark_md", "content": `**ğŸ“ ç”µè¯ï¼š**\n${data.phone}` } },
                        { "is_short": true, "text": { "tag": "lark_md", "content": `**âš–ï¸ BMIï¼š**\n${bmiVal}` } },
                        { "is_short": true, "text": { "tag": "lark_md", "content": `**ğŸ“ èº«é«˜ï¼š**\n${data.height}cm` } }
                    ]}
                ]
            }
        };

        try {
            await fetch(webhookUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(cardPayload)
            });
            document.getElementById('resultModal').classList.remove('hidden');
        } catch (e) {
            alert("æäº¤å¤±è´¥ï¼Œè¯·æ£€æŸ¥åœ°å€");
        }
    });
</script>
</body>
</html>
